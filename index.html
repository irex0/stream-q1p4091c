<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Channel</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&family=Inter:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>

<body>
    <div class="glow"></div>
    <header>
        <a href="index.html" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="url(#grad1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <defs>
                    <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            VidFlow
        </a>
    </header>

    <div class="container">
        <div class="watch-layout">
            <div class="main-player">
                <div class="video-wrapper">
                    <video id="video" controls autoplay></video>
                </div>
                <!-- Video Info -->
                <div class="video-info">
                    <h1 class="video-title" id="vidTitle">Loading...</h1>
                    <div class="card-meta" id="vidDate"></div>
                    <br>
                    <div class="video-desc" id="vidDesc"></div>
                </div>
            </div>

            <div class="sidebar">
                <h3 class="sidebar-title">Related Videos</h3>
                <div id="relatedList">
                    <!-- Related videos injected here -->
                </div>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let videoId = urlParams.get('v');
        const video = document.getElementById('video');

        // Logic: 
        // 1. If videoData exists...
        // 2. If videoId provides, find it.
        // 3. If NO videoId, default to the FIRST (latest) video.

        if (window.videoData && window.videoData.length > 0) {

            let currentVideo = null;
            if (videoId) {
                currentVideo = window.videoData.find(v => v.id === videoId);
            }

            // Default to latest if not found or not provided
            if (!currentVideo) {
                currentVideo = window.videoData[0];
                videoId = currentVideo.id;
                // Optional: update URL without reload?
                // history.replaceState(null, '', `?v=${videoId}`);
            }

            // Update UI
            document.title = `${currentVideo.title} - VidFlow`;
            document.getElementById('vidTitle').textContent = currentVideo.title;
            document.getElementById('vidDesc').textContent = currentVideo.description;
            document.getElementById('vidDate').textContent = new Date(currentVideo.date).toLocaleDateString();

            // Play
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(currentVideo.playlist);
                hls.attachMedia(video);
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = currentVideo.playlist;
            }

            // Render Sidebar
            const relatedList = document.getElementById('relatedList');
            window.videoData.forEach(v => {
                const isAssert = (v.id === videoId) ? 'active' : '';

                const link = document.createElement('a');
                link.href = `index.html?v=${v.id}`; // Point to index now
                link.className = `related-card ${isAssert}`;
                link.innerHTML = `
                    <div class="related-thumb">
                        <img src="${v.thumbnail}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NDAiIGhlaWdodD0iMzYwIiB2aWV3Qm94PSIwIDAgNjQwIDM2MCIgZmlsbD0iIzMzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgLz48L3N2Zz4='">
                    </div>
                    <div class="related-info">
                        <div class="related-title">${v.title}</div>
                        <div class="card-meta">${new Date(v.date).toLocaleDateString()}</div>
                    </div>
                `;
                relatedList.appendChild(link);
            });

        } else {
            document.getElementById('vidTitle').textContent = "No videos found.";
            document.getElementById('vidDesc').textContent = "Upload a video to get started!";
        }
    </script>
</body>

</html>